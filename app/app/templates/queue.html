<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BB Karaoke - Download Queue</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Add this for mobile devices -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="fixed-header">

    <!-- Logo (Fixed at the top) -->
    <div class="logo fixed-top">
        <a href="/" class="logo-text">BB Karaoke</a>
    </div>

    <!-- Accordion Navigation -->
    <div class="accordion-nav">
        <button class="accordion-btn" onclick="toggleAccordion()">☰</button>
        <div class="accordion-content">
            <a href="/" class="nav-link">Home</a>
            <a href="/queue" class="nav-link">Queue</a>
            <a href="/song_list" class="nav-link">Song List</a>
            <a href="/playlist" class="nav-link">Playlist</a>
        </div>
    </div>

    <!-- Queue Container -->
    <div class="queue-container">
        <h2>Download Queue:</h2>
        {% if songs_in_queue %}
            <div class="results-list">
                {% for song in songs_in_queue %}
                    <div class="result-item">
                        <form method="POST" action="{{ url_for('main.remove_from_queue', song_id=song.id) }}">
                            <button type="submit" class="remove-button">×</button>
                        </form>
                        <strong>{{ song.name }}</strong><br>
                        <span class="artist">by: {{ song.artist }}</span><br>
                        <span class="album">album: {{ song.album }}</span><br>
                        <span class="status">status: {{ song.status }}</span>
                        <div class="progress-bar">
                            <div class="progress" id="progress-{{ loop.index0 }}"></div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No songs in the queue.</p>
        {% endif %}
    </div>

    <script>
        const queueContainer = document.querySelector('.queue-container');
        const logo = document.querySelector('.logo');

        // Toggle function for accordion menu
        function toggleAccordion() {
            var content = document.querySelector('.accordion-content');
            content.style.display = (content.style.display === 'block') ? 'none' : 'block';
        }

        // Close the accordion when clicking outside
        document.addEventListener('click', function(event) {
            var isClickInside = document.querySelector('.accordion-nav').contains(event.target);
            if (!isClickInside) {
                document.querySelector('.accordion-content').style.display = 'none';
            }
        });

        // Close the accordion when clicking outside
        document.addEventListener('click', function(event) {
            var isClickInside = document.querySelector('.accordion-nav').contains(event.target);
            if (!isClickInside) {
                document.querySelector('.accordion-content').style.display = 'none';
            }
        });

        // Function to fetch progress data periodically
        function fetchProgress() {
            {% for song in songs_in_queue %}
                (function(songId, songIndex) {
                    fetch('/progress/' + songId)
                        .then(response => response.json())
                        .then(data => {
                            var progressElement = document.getElementById('progress-' + songIndex);
                            if (progressElement) {
                                progressElement.style.width = data.progress + '%';
                                progressElement.innerText = data.status;
                            }
                        });
                })({{ song.id }}, {{ loop.index0 }});
            {% endfor %}
        }

        // Fetch progress every 5 seconds
        setInterval(fetchProgress, 5000);
        // Initial fetch
        fetchProgress();

        // Remove song from queue
        function removeFromQueue(songId) {
            fetch('/remove_from_queue/' + songId, {
                method: 'POST'
            }).then(() => {
                location.reload();
            });
        }
    </script>

</body>
</html>
